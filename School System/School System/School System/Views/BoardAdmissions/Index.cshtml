@model IEnumerable<SchoolManagementSystem.Models.BoardAdmission>

<h2 class="text-3xl font-bold text-gray-800 mb-8">Class 9 & 10 Board Admissions</h2>

<div class="overflow-x-auto">
<form method="get" class="mb-6 flex flex-wrap gap-6 items-end" id="filterForm">

    <!-- Class Filter -->
    <div class="flex flex-col">
        <label for="classFilter" class="text-sm font-medium text-gray-700 mb-1">Class</label>
        <select id="classFilter" name="classFilter"
                class="block w-48 rounded border border-gray-300 bg-white px-3 py-2
                       text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-300
                       focus:outline-none transition">
            <option value=@(string.IsNullOrEmpty(ViewBag.SelectedClass) ? "selected" : "")>All Classes</option>
            @foreach (var cls in ViewBag.ClassList)
            {
                if (cls == ViewBag.SelectedClass)
                {
                    <option value="@cls" selected>@cls</option>
                }
                else
                {
                    <option value="@cls">@cls</option>
                }
            }
        </select>
    </div>

    <!-- Year Filter -->
    <div class="flex flex-col">
        <label for="yearFilter" class="text-sm font-medium text-gray-700 mb-1">Board Year</label>
        <select id="yearFilter" name="yearFilter"
                class="block w-36 rounded border border-gray-300 bg-white px-3 py-2
                       text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-300
                       focus:outline-none transition">
            <option value=@(string.IsNullOrEmpty(ViewBag.SelectedYear) ? "selected" : "")>All Years</option>
            @foreach (var year in ViewBag.YearList)
            {
                if (year.ToString() == ViewBag.SelectedYear?.ToString())
                {
                    <option value="@year" selected>@year</option>
                }
                else
                {
                    <option value="@year">@year</option>
                }
            }
        </select>
    </div>

    <!-- Status Filter -->
    <div class="flex flex-col">
        <label for="statusFilter" class="text-sm font-medium text-gray-700 mb-1">Status</label>
        <select id="statusFilter" name="statusFilter"
                class="block w-36 rounded border border-gray-300 bg-white px-3 py-2
                       text-gray-700 focus:border-blue-500 focus:ring focus:ring-blue-300
                       focus:outline-none transition">
            <option value=@(string.IsNullOrEmpty(ViewBag.SelectedStatus) ? "selected" : "")>All Statuses</option>
            @foreach (var status in ViewBag.StatusList)
            {
                if (status == ViewBag.SelectedStatus)
                {
                    <option value="@status" selected>@status</option>
                }
                else
                {
                    <option value="@status">@status</option>
                }
            }
        </select>
    </div>

</form>



    <table class="min-w-full border border-gray-200 shadow-md rounded-lg overflow-hidden">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Student</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Class</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Admission Sent</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-center text-sm font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            @foreach (var ba in Model)
            {
                <tr class="hover:bg-gray-50 transition">
                    <!-- Student Name -->
                    <td class="px-6 py-4 text-gray-700 font-medium whitespace-nowrap">
                        @ba.Student.FullName
                    </td>
                    <td class="px-6 py-4 text-gray-700 font-medium whitespace-nowrap">
                        @ba.ClassName
                    </td>
                    <!-- Admission Sent -->
                    <td class="px-6 py-4">
                        @if (!ba.IsSent)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">
                                Pending
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                Sent at @ba.SentDate
                            </span>
                        }
                    </td>

                    <!-- Status -->
                    <td class="px-6 py-4">
                        @if (!ba.IsSent)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">
                                Pending
                            </span>
                        }
                        else if (ba.IsSent && !ba.IsRejected && !ba.ReceivedByStudent)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                Sent
                            </span>
                        }
                        else if (ba.IsSent && ba.IsRejected && !ba.ReceivedByStudent)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                                Arrived
                            </span>
                        }
                        else if (ba.ReceivedByStudent)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                ✅ Received at @ba.RecievedDate
                            </span>
                        }
                    </td>

                    <!-- Actions -->
                    <td class="px-6 py-4 text-center">
                        <div class="flex justify-center space-x-2">
                            @if (!ba.IsSent)
                            {
                                <form asp-action="MarkSent" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@ba.BoardAdmissionId" />
                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                                        Mark Sent
                                    </button>
                                </form>
                            }
                            else if (ba.IsSent && !ba.IsRejected && !ba.ReceivedByStudent)
                            {
                                <form asp-action="MarkArrived" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@ba.BoardAdmissionId" />
                                    <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                                        Mark Arrived
                                    </button>
                                </form>
                            }
                            else if (ba.IsSent && ba.IsRejected && !ba.ReceivedByStudent)
                            {
                                <form asp-action="MarkReceived" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@ba.BoardAdmissionId" />
                                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                                        Mark Received
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                    ✅ Received at @ba.RecievedDate
                                </span>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<script>
    // Auto-submit form on dropdown change
    document.querySelectorAll('#filterForm select').forEach(select => {
        select.addEventListener('change', () => {
            document.getElementById('filterForm').submit();
        });
    });
</script>