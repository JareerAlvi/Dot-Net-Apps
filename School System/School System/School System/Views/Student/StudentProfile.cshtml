@model StudentProfileViewModel

@{
    ViewData["Title"] = "Student Profile";
}

<div class="max-w-6xl mx-auto px-4 py-8">

    <h2 class="text-3xl font-bold text-gray-800 mb-6">📄 Student Profile</h2>

    <div class="grid grid-cols-2 gap-6 bg-white shadow-md rounded-2xl p-6 mb-8">
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Full Name</h4>
            <p class="text-gray-900">@Model.FullName</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Class</h4>
            <p class="text-gray-900">@Model.ClassName</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Date of Birth</h4>
            <p class="text-gray-900">@Model.DateOfBirth</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Admission Date</h4>
            <p class="text-gray-900">@Model.AdmissionDate</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Gender</h4>
            <p class="text-gray-900">@Model.Gender</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Guardian Name</h4>
            <p class="text-gray-900">@Model.GuardianName</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Phone</h4>
            <p class="text-gray-900">@Model.Phone</p>
        </div>
        <div>
            <h4 class="font-semibold text-gray-700 mb-2">Email</h4>
            <p class="text-gray-900">@Model.Email</p>
        </div>
        <div class="col-span-2">
            <h4 class="font-semibold text-gray-700 mb-2">Address</h4>
            <p class="text-gray-900">@Model.Address</p>
        </div>


        <div >
            <a asp-action="ManageStudents" class="inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">
                ← Back to Students
            </a>
        </div>

    </div>

    <div class="bg-blue-50 rounded-2xl shadow-md p-6 mb-8">
        <h3 class="text-xl font-bold text-blue-700 mb-4">💸 Current Fee Status</h3>

        <div class="grid grid-cols-3 gap-4 text-gray-800 mb-4">
            <div>
                <h4 class="font-semibold">Amount</h4>
                <p>@(Model.LastFeeAmount.HasValue? Model.LastFeeAmount.Value.ToString("C") : "N/A")</p>
            </div>
            <div>
                <h4 class="font-semibold">Due Date</h4>
                <p>@(Model.LastFeeDueDate.HasValue? Model.LastFeeDueDate.Value.ToString("yyyy-MM-dd") : "N/A")</p>
            </div>
            <div>
                <h4 class="font-semibold">Status</h4>
                <p class="@(Model.LastFeeStatus == "Paid" ? "text-green-600 font-bold" :
                                                Model.LastFeeStatus == "Partial" ? "text-yellow-600 font-bold" :
                                                "text-red-500 font-bold")">
                    @(!string.IsNullOrEmpty(Model.LastFeeStatus) ? Model.LastFeeStatus : "N/A")
                </p>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.LastFeeStatus) &&
                (Model.LastFeeStatus == "Pending" || Model.LastFeeStatus == "Unpaid"))
        {
            <form asp-action="ReceiveFee" method="post">
                <input type="hidden" name="studentId" value="@Model.StudentId" />
                <button class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded transition">
                    💰 Mark as Received
                </button>
            </form>
        }
    </div>

    <div class="bg-white rounded-2xl shadow-md p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4">📜 Fee History</h3>

        @if (Model.Fees != null && Model.Fees.Any())
        {
            <table class="w-full text-left text-gray-700 border border-gray-200 rounded overflow-hidden">
                <thead class="bg-gray-100 text-gray-800">
                    <tr>
                        <th class="px-4 py-2 border">#</th>
                        <th class="px-4 py-2 border">Amount</th>
                        <th class="px-4 py-2 border">Due Date</th>
                        <th class="px-4 py-2 border">Paid Date</th>
                        <th class="px-4 py-2 border">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Fees.Count; i++)
                    {
                        var fee = Model.Fees[i];
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-2 border">@((i + 1))</td>
                            <td class="px-4 py-2 border">@fee.FeeAmount</td>
                            <td class="px-4 py-2 border">@fee.DueDate?.ToString("yyyy-MM-dd")</td>
                            <td class="px-4 py-2 border">
                                @if (fee.PaymentDate.HasValue)
                                {
                                    @fee.PaymentDate.Value.ToDateTime(new TimeOnly()).ToString("MM/dd/yyyy")
                                }
                                else
                                {
                                    <span>Pending</span>
                                }
                            </td>
                            <td class="px-4 py-2 border font-semibold text-center">
                                @if (fee.PaymentStatus == "Unpaid" || fee.PaymentStatus == "Pending")
                                {
                                    <div class="inline-flex items-center space-x-2">
                                        <span class="text-red-700">@fee.PaymentStatus</span>
                                        <form asp-action="ReceiveFee" method="post" class="inline">
                                            <input type="hidden" name="feeId" value="@fee.FeeId" />
                                            <input type="hidden" name="studentId" value="@Model.StudentId" />
                                            <button type="submit"
                                                    class="ml-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-4 rounded transition">
                                                Mark as Paid
                                            </button>
                                        </form>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-green-700">@fee.PaymentStatus</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-gray-600">No fee records found.</p>
        }
    </div>
</div>
